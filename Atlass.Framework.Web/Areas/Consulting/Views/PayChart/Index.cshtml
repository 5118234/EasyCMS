
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Index.cshtml";
}
    <div class="wrapper wrapper-content  animated fadeInRight">
        <div class="ibox">
            <div class="ibox-content">
                <div id="toolbar" class="btn-group">
                    <form role="form" class="form-inline">
                        <div class="form-group">
                            <input type="text" placeholder="起始时间" id="stime" class="form-control" value="@(DateTime.Now.AddMonths(-3).ToString("yyyy-MM"))">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="结束时间" id="etime" class="form-control" value="@(DateTime.Now.ToString("yyyy-MM"))">
                        </div>
                        <button class="btn btn-white" type="button" onclick="query()"><i class="fa fa-search"></i>查询</button>
                        <button class="btn btn-white" type="button" onclick="outfile()"><i class="fa fa-upload"></i>导出</button>
                    </form>
                </div>
                <div>
                    <table id="roleTable"></table>
                </div>
            </div>
        </div>
    </div>
        @section scripts
{
            <script src="~/plugins/laydate/laydate.js"></script>
            <script>
                var $roleTable;
                $(function () {
                    laydate.render({
                        elem: '#stime'
                        , theme: 'molv'
                        , type: 'month'
                    });
                    laydate.render({
                        elem: '#etime'
                        , theme: 'molv'
                        , type: 'month'
                    });
                    loadGrid();
                });

                function loadGrid() {
                    $roleTable = $("#roleTable").bootstrapTable({
                        url: '/Consulting/PayChart/GetData',
                        toolbar: '#toolbar',
                        pagination: true,
                        height: $(window).height() - 50,
                        pageSize: 15,
                        pageList: [5, 10, 15, 20],
                        showColumns: true,
                        showRefresh: true,
                        clickToSelect: true,
                        sidePagination: "server",
                        locale: "zh-CN",
                        striped: true,
                        queryParams: function (params) {
                            var stime = $('#stime').val();
                            var etime = $('#etime').val();
                            var params2 = {
                                limit: params.limit, //每页多少条
                                offset: params.offset, //从第几条开始读(默认就好)
                                stime: stime,
                                etime: etime
                            };
                            return params2;
                        },
                        columns: [
                            { field: 'yearNumString', title: '月份', align: 'center' },
                            { field: 'expertName', title: '专家', align: 'center' },
                            {field: 'totalFee', title: '打赏金额（元）', align: 'center'},
                            {
                               field: 'end', title: '结算状态', align: 'center', formatter: function (v) {
                                    if (v === 1) {
                                        return '<span class="label label-primary">已结算</span>';
                                    }
                                    return '待结算';
                                }
                            },
                            { field: 'id', title: '操作', align: 'center', formatter: renderOpt },
                        ]

                    });

                    //jutils.initToolBarRole('#toolbar');
                }

                function query() {
                    $roleTable.bootstrapTable('refresh');
                }

                //渲染操作
                function renderOpt(v, r, i) {
                    var html = jutils.initToolBarRow(v);

                    return html;
                }

                function add() {
                    jutils.dialogForm('快捷回复',
                        '/Consulting/quickinfo/form',
                        { id: 0 },
                        function (res) {
                            $roleTable.bootstrapTable('refresh');
                        });
                }

                function pay(obj) {
                    var id = $(obj).data('id');
                    jutils.confirm('确认结算吗',
                        function () {
                            jutils.ajaxGet('/Consulting/PayChart/Pay',
                                { id: id },
                                function () {
                                    $roleTable.bootstrapTable('refresh');
                                });
                        });
                }

                function outfile() {
                    var stime = $('#stime').val();
                    var etime = $('#etime').val();

                    if (!stime) {
                        jutils.info("请选择起始时间");
                        return;
                    }
                    if (!etime) {
                        jutils.info("请选择结束时间");
                        return;
                    }

                    location.href = '/Consulting/payhistory/outfile?stime=' + stime + "&etime=" + etime;
                }
            </script>


        }







